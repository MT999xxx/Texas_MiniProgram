<view class="container">
  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tabs">
    <view
      wx:for="{{tabs}}"
      wx:key="status"
      class="tab-item {{currentTab === item.status ? 'active' : ''}}"
      bindtap="switchTab"
      data-status="{{item.status}}"
    >
      <text class="tab-text">{{item.label}}</text>
      <view wx:if="{{currentTab === item.status}}" class="tab-indicator"></view>
    </view>
  </view>

  <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
  <view class="list-container">
    <view wx:if="{{loading}}" class="loading-box">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <view wx:elif="{{coupons.length === 0 && currentTab === 'available'}}" class="empty-box">
      <text class="empty-icon">ğŸ«</text>
      <text class="empty-text">æš‚æ— å¯é¢†å–çš„ä¼˜æƒ åˆ¸</text>
    </view>

    <view wx:elif="{{coupons.length === 0}}" class="empty-box">
      <text class="empty-icon">ğŸ’³</text>
      <text class="empty-text">æš‚æ— {{currentTabLabel}}ä¼˜æƒ åˆ¸</text>
      <button wx:if="{{currentTab !== 'available'}}" class="btn-goto-available" bindtap="gotoAvailable">é¢†å–ä¼˜æƒ åˆ¸</button>
    </view>

    <view wx:else class="coupon-list">
      <!-- å¯é¢†å–ä¼˜æƒ åˆ¸ -->
      <view wx:if="{{currentTab === 'available'}}" wx:for="{{coupons}}" wx:key="id" class="coupon-card available-coupon">
        <view class="coupon-left">
          <view class="coupon-amount">
            <text wx:if="{{item.type === 'AMOUNT'}}" class="amount-value">Â¥{{item.value}}</text>
            <text wx:elif="{{item.type === 'DISCOUNT'}}" class="amount-value">{{item.value}}æŠ˜</text>
            <text wx:elif="{{item.type === 'PERCENTAGE'}}" class="amount-value">{{item.value}}%</text>
            <text class="amount-label">ä¼˜æƒ åˆ¸</text>
          </view>
          <view class="coupon-type type-available">å¯é¢†å–</view>
        </view>

        <view class="coupon-right">
          <view class="coupon-header">
            <text class="coupon-name">{{item.name}}</text>
            <view wx:if="{{item.minMemberLevel > 1}}" class="member-level-tag">
              V{{item.minMemberLevel}}ä¸“äº«
            </view>
          </view>

          <view wx:if="{{item.description}}" class="coupon-desc">{{item.description}}</view>

          <view class="coupon-condition">
            <text wx:if="{{item.minAmount > 0}}">æ»¡{{item.minAmount}}å…ƒå¯ç”¨</text>
            <text wx:else>æ— é—¨æ§›</text>
          </view>

          <view class="coupon-validity">
            <text>{{item.validityText}}</text>
          </view>

          <view class="coupon-stock">
            <text>å‰©ä½™ {{item.totalQuantity - item.claimedQuantity}} / {{item.totalQuantity}}</text>
          </view>

          <view class="coupon-actions">
            <button
              class="btn-claim {{item.canClaim ? '' : 'disabled'}}"
              bindtap="claimCoupon"
              data-id="{{item.id}}"
              disabled="{{!item.canClaim}}"
            >
              {{item.claimText}}
            </button>
          </view>
        </view>
      </view>

      <!-- æˆ‘çš„ä¼˜æƒ åˆ¸ -->
      <view wx:else wx:for="{{coupons}}" wx:key="id" class="coupon-card my-coupon">
        <view class="coupon-left">
          <view class="coupon-amount">
            <text wx:if="{{item.coupon.type === 'AMOUNT'}}" class="amount-value">Â¥{{item.coupon.value}}</text>
            <text wx:elif="{{item.coupon.type === 'DISCOUNT'}}" class="amount-value">{{item.coupon.value}}æŠ˜</text>
            <text wx:elif="{{item.coupon.type === 'PERCENTAGE'}}" class="amount-value">{{item.coupon.value}}%</text>
            <text class="amount-label">ä¼˜æƒ åˆ¸</text>
          </view>
          <view class="coupon-type type-{{item.status}}">{{item.statusText}}</view>
        </view>

        <view class="coupon-right">
          <view class="coupon-header">
            <text class="coupon-name">{{item.coupon.name}}</text>
            <text class="coupon-code">{{item.code}}</text>
          </view>

          <view wx:if="{{item.coupon.description}}" class="coupon-desc">{{item.coupon.description}}</view>

          <view class="coupon-condition">
            <text wx:if="{{item.coupon.minAmount > 0}}">æ»¡{{item.coupon.minAmount}}å…ƒå¯ç”¨</text>
            <text wx:else>æ— é—¨æ§›</text>
          </view>

          <view class="coupon-time">
            <view class="time-row">
              <text class="time-label">æœ‰æ•ˆæœŸ:</text>
              <text class="time-value">{{item.validityText}}</text>
            </view>
            <view wx:if="{{item.usedAt}}" class="time-row">
              <text class="time-label">ä½¿ç”¨æ—¶é—´:</text>
              <text class="time-value">{{item.usedAtText}}</text>
            </view>
          </view>

          <view wx:if="{{item.status === 'AVAILABLE'}}" class="coupon-actions">
            <button class="btn-use" bindtap="useCoupon" data-id="{{item.id}}">
              ç«‹å³ä½¿ç”¨
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>