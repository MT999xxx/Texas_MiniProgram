<view class="container">
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view wx:else class="detail-container">
    <!-- è®¢å•çŠ¶æ€ -->
    <view class="status-section">
      <view class="status-icon status-icon-{{order.status}}">
        <text wx:if="{{order.status === 'PENDING'}}">ğŸ’°</text>
        <text wx:elif="{{order.status === 'PAID'}}">âœ…</text>
        <text wx:elif="{{order.status === 'IN_PROGRESS'}}">â³</text>
        <text wx:elif="{{order.status === 'COMPLETED'}}">ğŸ‰</text>
        <text wx:elif="{{order.status === 'CANCELLED'}}">âŒ</text>
      </view>
      <view class="status-info">
        <text class="status-text">{{order.statusText}}</text>
        <text class="status-time">{{order.createdAtText}}</text>
      </view>
    </view>

    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="info-section">
      <view class="section-title">
        <text class="title-icon">ğŸ“‹</text>
        <text>è®¢å•ä¿¡æ¯</text>
      </view>

      <view class="info-row">
        <text class="info-label">è®¢å•å·</text>
        <text class="info-value">{{order.orderNumber}}</text>
      </view>

      <view class="info-row">
        <text class="info-label">ä¸‹å•æ—¶é—´</text>
        <text class="info-value">{{order.createdAtText}}</text>
      </view>

      <view wx:if="{{order.table}}" class="info-row">
        <text class="info-label">ç”¨é¤ä½ç½®</text>
        <view class="table-info">
          <text class="info-value">{{order.table.name}}</text>
          <text wx:if="{{order.reservation}}" class="reservation-tag">é¢„çº¦</text>
        </view>
      </view>

      <view wx:if="{{order.member}}" class="info-row">
        <text class="info-label">ä¼šå‘˜ä¿¡æ¯</text>
        <text class="info-value">{{order.member.nickname || order.member.name}}</text>
      </view>
    </view>

    <!-- å•†å“æ¸…å• -->
    <view class="items-section">
      <view class="section-title">
        <text class="title-icon">ğŸ½</text>
        <text>å•†å“æ¸…å•</text>
      </view>

      <view class="items-container">
        <view
          wx:for="{{order.items}}"
          wx:key="id"
          class="item-card"
        >
          <view class="item-content">
            <view class="item-header">
              <text class="item-name">{{item.menuItem.name}}</text>
              <view class="item-price-info">
                <text class="item-quantity">Ã—{{item.quantity}}</text>
                <text class="item-amount">Â¥{{item.amount}}</text>
              </view>
            </view>

            <view wx:if="{{item.menuItem.description}}" class="item-description">
              {{item.menuItem.description}}
            </view>

            <view wx:if="{{item.menuItem.category}}" class="item-category">
              åˆ†ç±»: {{item.menuItem.category.name}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è´¹ç”¨æ˜ç»† -->
    <view class="cost-section">
      <view class="section-title">
        <text class="title-icon">ğŸ’°</text>
        <text>è´¹ç”¨æ˜ç»†</text>
      </view>

      <view class="cost-container">
        <view class="cost-row">
          <text class="cost-label">å•†å“å°è®¡</text>
          <text class="cost-value">Â¥{{order.totalAmount}}</text>
        </view>

        <!-- æŠ˜æ‰£ä¿¡æ¯(å¦‚æœæœ‰ä¼šå‘˜æŠ˜æ‰£) -->
        <view wx:if="{{order.discount > 0}}" class="cost-row">
          <text class="cost-label">ä¼šå‘˜æŠ˜æ‰£</text>
          <text class="cost-value cost-discount">-Â¥{{order.discount}}</text>
        </view>

        <view class="cost-divider"></view>

        <view class="cost-row cost-total">
          <text class="cost-label">å®ä»˜é‡‘é¢</text>
          <text class="cost-value">Â¥{{order.finalAmount || order.totalAmount}}</text>
        </view>
      </view>
    </view>

    <!-- è®¢å•è¿›åº¦ -->
    <view wx:if="{{order.status !== 'CANCELLED'}}" class="progress-section">
      <view class="section-title">
        <text class="title-icon">ğŸ“ˆ</text>
        <text>è®¢å•è¿›åº¦</text>
      </view>

      <view class="progress-container">
        <view
          wx:for="{{progressSteps}}"
          wx:key="status"
          class="progress-step {{item.completed ? 'completed' : ''}} {{item.current ? 'current' : ''}}"
        >
          <view class="step-indicator">
            <view wx:if="{{item.completed}}" class="step-icon step-completed">âœ“</view>
            <view wx:elif="{{item.current}}" class="step-icon step-current">â—</view>
            <view wx:else class="step-icon step-pending">â—‹</view>
          </view>
          <view class="step-content">
            <text class="step-title">{{item.title}}</text>
            <text wx:if="{{item.time}}" class="step-time">{{item.time}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-section">
      <view wx:if="{{order.status === 'PENDING'}}" class="button-group">
        <button class="btn btn-cancel" bindtap="cancelOrder">å–æ¶ˆè®¢å•</button>
        <button class="btn btn-primary" bindtap="payOrder">ç«‹å³æ”¯ä»˜</button>
      </view>

      <view wx:elif="{{order.status === 'PAID' || order.status === 'IN_PROGRESS'}}" class="button-group">
        <button class="btn btn-secondary" bindtap="contactService">è”ç³»å®¢æœ</button>
      </view>

      <view wx:elif="{{order.status === 'COMPLETED'}}" class="button-group">
        <button class="btn btn-secondary" bindtap="reorder">å†æ¥ä¸€å•</button>
      </view>
    </view>
  </view>
</view>