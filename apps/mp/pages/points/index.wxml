<view class="points-container">
  <!-- ç§¯åˆ†æ¦‚è§ˆ -->
  <view class="points-overview">
    <view class="overview-card">
      <view class="total-points">
        <text class="points-value">{{totalPoints}}</text>
        <text class="points-label">å½“å‰ç§¯åˆ†</text>
      </view>
      <view class="points-trend">
        <view class="trend-item">
          <text class="trend-value">+{{monthlyEarned}}</text>
          <text class="trend-label">æœ¬æœˆè·å¾—</text>
        </view>
        <view class="trend-item">
          <text class="trend-value used">-{{monthlyUsed}}</text>
          <text class="trend-label">æœ¬æœˆä½¿ç”¨</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½åŒº -->
  <view class="function-area">
    <view class="function-item" bindtap="showRules">
      <view class="function-icon">ğŸ“‹</view>
      <text class="function-text">ç§¯åˆ†è§„åˆ™</text>
    </view>
    <view class="function-item" bindtap="showExchange">
      <view class="function-icon">ğŸ</view>
      <text class="function-text">ç§¯åˆ†å…‘æ¢</text>
    </view>
    <view class="function-item" bindtap="navigateToRanking">
      <view class="function-icon">ğŸ†</view>
      <text class="function-text">æ’è¡Œæ¦œ</text>
    </view>
  </view>

  <!-- ç§¯åˆ†æ˜ç»† -->
  <view class="points-details">
    <view class="details-header">
      <text class="header-title">ç§¯åˆ†æ˜ç»†</text>
      <view class="filter-tabs">
        <text
          wx:for="{{filterTabs}}"
          wx:key="value"
          class="tab-item {{currentTab === item.value ? 'active' : ''}}"
          bindtap="switchTab"
          data-tab="{{item.value}}"
        >
          {{item.label}}
        </text>
      </view>
    </view>

    <scroll-view class="details-list" scroll-y refresher-enabled refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh">
      <view wx:if="{{transactions.length === 0 && !loading}}" class="empty-state">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— ç§¯åˆ†è®°å½•</text>
      </view>

      <view wx:for="{{transactions}}" wx:key="id" class="transaction-item">
        <view class="transaction-info">
          <view class="transaction-header">
            <text class="transaction-title">{{item.description}}</text>
            <text class="transaction-amount {{item.type === 'EARNED' ? 'earned' : 'used'}}">
              {{item.type === 'EARNED' ? '+' : '-'}}{{item.amount}}
            </text>
          </view>
          <view class="transaction-meta">
            <text class="transaction-date">{{item.formattedDate}}</text>
            <text class="transaction-status">{{item.statusText}}</text>
          </view>
        </view>
      </view>

      <view wx:if="{{hasMore && !loading}}" class="load-more" bindtap="loadMore">
        <text>åŠ è½½æ›´å¤š</text>
      </view>

      <view wx:if="{{loading}}" class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </scroll-view>
  </view>

  <!-- ç§¯åˆ†è§„åˆ™å¼¹çª— -->
  <view class="modal {{showRulesModal ? 'show' : ''}}" catchtap="hideRules">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç§¯åˆ†è§„åˆ™</text>
        <text class="modal-close" bindtap="hideRules">Ã—</text>
      </view>
      <scroll-view class="modal-body" scroll-y>
        <view class="rules-section">
          <text class="section-title">è·å–ç§¯åˆ†</text>
          <view class="rule-item">
            <text class="rule-text">â€¢ æ¶ˆè´¹æ»¡1å…ƒè·å¾—1ç§¯åˆ†</text>
          </view>
          <view class="rule-item">
            <text class="rule-text">â€¢ é¢„çº¦å¹¶åˆ°åº—ç­¾åˆ°è·å¾—50ç§¯åˆ†</text>
          </view>
          <view class="rule-item">
            <text class="rule-text">â€¢ å‚ä¸æ´»åŠ¨æœ€é«˜å¯è·å¾—500ç§¯åˆ†</text>
          </view>
          <view class="rule-item">
            <text class="rule-text">â€¢ é‚€è¯·å¥½å‹æ³¨å†Œè·å¾—100ç§¯åˆ†</text>
          </view>
        </view>

        <view class="rules-section">
          <text class="section-title">ä½¿ç”¨ç§¯åˆ†</text>
          <view class="rule-item">
            <text class="rule-text">â€¢ 100ç§¯åˆ† = 1å…ƒç°é‡‘æŠµæ‰£</text>
          </view>
          <view class="rule-item">
            <text class="rule-text">â€¢ ç§¯åˆ†å¯å…‘æ¢ä¸“å±ç¤¼å“</text>
          </view>
          <view class="rule-item">
            <text class="rule-text">â€¢ ç§¯åˆ†å¯å‚ä¸æŠ½å¥–æ´»åŠ¨</text>
          </view>
        </view>

        <view class="rules-section">
          <text class="section-title">æ³¨æ„äº‹é¡¹</text>
          <view class="rule-item">
            <text class="rule-text">â€¢ ç§¯åˆ†æœ‰æ•ˆæœŸä¸º1å¹´</text>
          </view>
          <view class="rule-item">
            <text class="rule-text">â€¢ é€€æ¬¾è®¢å•å°†æ‰£é™¤å¯¹åº”ç§¯åˆ†</text>
          </view>
          <view class="rule-item">
            <text class="rule-text">â€¢ æœ€ç»ˆè§£é‡Šæƒå½’æœ¬åº—æ‰€æœ‰</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- ç§¯åˆ†å…‘æ¢å¼¹çª— -->
  <view class="modal {{showExchangeModal ? 'show' : ''}}" catchtap="hideExchange">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç§¯åˆ†å…‘æ¢</text>
        <text class="modal-close" bindtap="hideExchange">Ã—</text>
      </view>
      <scroll-view class="modal-body" scroll-y>
        <view wx:for="{{exchangeItems}}" wx:key="id" class="exchange-item">
          <view class="exchange-info">
            <text class="exchange-title">{{item.name}}</text>
            <text class="exchange-desc">{{item.description}}</text>
            <text class="exchange-points">{{item.points}}ç§¯åˆ†</text>
          </view>
          <button
            class="exchange-btn {{totalPoints >= item.points ? '' : 'disabled'}}"
            bindtap="exchangeItem"
            data-id="{{item.id}}"
            disabled="{{totalPoints < item.points}}"
          >
            {{totalPoints >= item.points ? 'å…‘æ¢' : 'ç§¯åˆ†ä¸è¶³'}}
          </button>
        </view>
      </scroll-view>
    </view>
  </view>
</view>