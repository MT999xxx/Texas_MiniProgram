<view class="history-container">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="header-section">
    <view class="page-title">
      <text>å……å€¼è®°å½•</text>
    </view>
    <view class="recharge-btn" bindtap="goToRecharge">
      <text>å……å€¼</text>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="history-content">
    <scroll-view
      scroll-y
      refresher-enabled
      refresher-triggered="{{refreshing}}"
      bindrefresherrefresh="onRefresh"
      bindscrolltolower="loadRechargeHistory"
      class="history-scroll"
    >
      <view wx:for="{{rechargeHistory}}" wx:key="id" class="record-card">
        <!-- è®°å½•å¤´éƒ¨ -->
        <view class="record-header">
          <view class="package-info">
            <text class="package-name">{{item.package.name}}</text>
            <text class="record-time">{{item.timeText}}</text>
          </view>
          <view class="status-info">
            <view class="status-badge status-{{item.status}}">
              <text>{{item.statusText}}</text>
            </view>
            <text class="amount-text">Â¥{{item.amount}}</text>
          </view>
        </view>

        <!-- ç§¯åˆ†è¯¦æƒ… -->
        <view class="points-details">
          <view class="points-row">
            <text class="label">åŸºç¡€ç§¯åˆ†ï¼š</text>
            <text class="value">{{item.points}}</text>
          </view>
          <view wx:if="{{item.bonusPoints > 0}}" class="points-row bonus">
            <text class="label">å¥–åŠ±ç§¯åˆ†ï¼š</text>
            <text class="value">+{{item.bonusPoints}}</text>
          </view>
          <view class="points-row total">
            <text class="label">æ€»è®¡ç§¯åˆ†ï¼š</text>
            <text class="value total-value">{{item.points + item.bonusPoints}}</text>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="record-actions">
          <button
            class="action-btn detail-btn"
            bindtap="viewRechargeDetail"
            data-id="{{item.id}}"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </button>
          <button
            wx:if="{{item.status === 'PENDING'}}"
            class="action-btn pay-btn"
            bindtap="continuePay"
            data-id="{{item.id}}"
          >
            ç»§ç»­æ”¯ä»˜
          </button>
        </view>

        <!-- å®Œæˆæ—¶é—´ -->
        <view wx:if="{{item.completedTimeText && item.status === 'SUCCESS'}}" class="completed-time">
          <text class="completed-label">å®Œæˆæ—¶é—´ï¼š</text>
          <text class="completed-value">{{item.completedTimeText}}</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{rechargeHistory.length === 0 && !loading}}" class="empty-state">
        <text class="empty-icon">ğŸ’³</text>
        <text class="empty-text">æš‚æ— å……å€¼è®°å½•</text>
        <button class="empty-btn" bindtap="goToRecharge">
          ç«‹å³å……å€¼
        </button>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{loading}}" class="loading-more">
        <text>åŠ è½½ä¸­...</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view wx:if="{{!hasMore && rechargeHistory.length > 0}}" class="no-more">
        <text>æ²¡æœ‰æ›´å¤šè®°å½•äº†</text>
      </view>
    </scroll-view>
  </view>
</view>