# 德州扑克主题酒吧服务型小程序开发计划

## 1. 项目概述
- **业务目标**：满足玩家到店前预约主/副赛桌、到店后自助点餐买单，并通过积分+排行榜+会员体系提升复购与粘性。
- **交付范围**：微信小程序（顾客侧）+ Web 管理控制台（店铺运营侧）+ 后端服务与数据层 + 运维部署方案。
- **品牌调性**：参考 `F:\waibao\Texas_MiniProgram\图片资料` 中的模板截图（如首页、会员、排行榜、点单、积分说明等），突出德州扑克主题、夜间酒吧氛围和高端赛事感。

## 2. 用户旅程与关键体验
1. **到店前**：用户浏览公告/活动 → 查看实时桌位 → 发起主赛桌/副赛桌预约并支付订金 → 收到预约确认与提醒。
2. **到店后**：扫码入场 → 查看个人会员权益与积分 → 点餐/加单/买单 → 积分实时到账并显示排行榜晋升。
3. **赛后运营**：系统推送排名、活动邀请、积分兑换提醒 → 用户可兑换福利或报名活动 → 形成闭环复购。

## 3. 功能规划
### 3.1 微信小程序端
| 模块 | 说明 |
| --- | --- |
| 身份 & 会员 | 微信授权登录、会员等级/权益展示、实名认证（高价值桌需验证）。 |
| 桌位预约 | 主赛桌/副赛桌配置、余位展示、预约表单、订金支付、预约记录、规则说明。 |
| 点餐 & 支付 | 菜单浏览、套餐/酒水/小吃分类、下单/加单、实时订单状态、微信支付、开发票入口。 |
| 积分系统 | 获取规则（点单、预约出席、活动参与）、积分明细、兑换规则、排行榜（总积分、周榜、活动榜）。 |
| 消息与活动 | 店铺公告、活动推送、预约/下单/积分模板消息、订阅消息中心。 |
| 账号设置 | 个人资料、常用联系人、开票信息、意见反馈。 |

### 3.2 店铺管理后台（Web）
| 模块 | 说明 |
| --- | --- |
| 仪表盘 | 即时订单、桌位占用、营业额、积分发放/消耗概览。 |
| 菜单与库存 | 菜品 CRUD、分类、售价/折扣、上下架、库存提醒。 |
| 桌位管理 | 主/副赛桌配置、赛段时间、预约限制、黑名单管理。 |
| 订单与对账 | 点餐订单流、退款、出餐状态同步、对账导出。 |
| 会员与积分 | 会员等级规则、积分调整、排行榜人工干预、积分兑换审批。 |
| 活动与公告 | 活动编辑、报名限制、公告推送、模板消息/订阅消息管理。 |
| 系统与权限 | 角色权限（店长/值班经理/服务员）、操作日志、配置管理。 |

## 4. 技术架构
- **小程序前端**：微信原生框架（WXML/WXSS/JS/TS）+ 自定义组件库；状态管理使用 MobX/Pinia for MiniProgram；使用云开发 CDN 缓存静态资源。
- **管理后台前端**：React + Vite + TypeScript + Ant Design Pro 体系，使用 Zustand/Redux Toolkit 管理状态，支持响应式布局。
- **服务端**：NestJS（Node.js）+ TypeScript；REST + WebSocket（实时桌位状态、订单推送）；OpenAPI 生成接口文档。
- **数据层**：MySQL（业务数据）、Redis（会话/排行榜缓存）、OSS/腾讯云 COS（图片）、Elasticsearch（可选，活动搜索/统计）。
- **基础设施**：部署于腾讯云（CVM + TKE）或阿里云同类资源；CI/CD 采用 GitHub Actions/腾讯云 DevOps；日志收集使用 ELK/阿里 SLS。

## 5. 核心数据模型（示例）
- `users`：openid、unionid、会员等级、可用积分、累计积分、偏好标签。
- `memberships`：等级、门槛、权益描述、折扣。
- `tables`：桌型（主/副）、座位数、赛段、预定状态。
- `reservations`：用户、桌位、时间段、订金、状态（待确认/已确认/已签到/爽约）。
- `menu_items` & `menu_categories`：菜品及分类、SKU、库存、售卖状态。
- `orders`、`order_items`：点餐明细、支付状态、出餐状态。
- `loyalty_transactions`：积分来源（订单、活动、系统调整）、数值、备注。
- `leaderboards`：榜单类型（总榜/周榜/活动榜）、排名快照、更新时间。

## 6. 积分与排行榜机制
1. **积分获取**：按实付金额比例 + 活动奖励 + 预约如期到店奖励 + 赛事成绩奖励（后台录入）。
2. **积分消耗**：兑换酒水、周边、活动报名；支持设置积分有效期与临期提醒。
3. **排行榜**：总积分、周积分、活动积分；计算脚本定时刷新并写入 Redis；小程序端拉取缓存，后台可手动重算。
4. **防刷策略**：设置单日上限、异常订单校验、运营后台审批特定积分操作。

## 7. 预约与点餐业务流程
1. **预约**：用户选择桌型→查看空位→填写参赛人数/备注→支付订金→系统锁位→店员后台确认→用户收到成功通知→到店扫码签到→订金抵扣或退款策略。
2. **点餐**：用户进入点餐页→选择菜品→下单并支付或挂账→订单推送到后厨屏→后厨更新状态→服务员确认上菜→用户可加单→订单完成触发积分发放。
3. **现场联动**：后台桌位面板实时同步预约与落座状态；订单关联桌位，便于服务调度。

## 8. 第三方集成
- **微信生态**：小程序登录（wx.login）、订阅消息、支付（JSAPI）、模板消息（兼容），云开发或自研上传接口。
- **支付/发票**：微信支付+微信电子发票；对账文件拉取和自动核对。
- **消息推送**：企业微信/钉钉告警（库存、预约异常）；短信备用通道（如腾讯云短信）。

## 9. 安全与合规
- 身份鉴权：JWT + 微信 session 校验，后台采用 OAuth2/账号密码 + MFA。
- 数据安全：HTTPS、数据库加密字段（电话、实名信息）、每日备份+跨可用区容灾。
- 权限/审计：RBAC、操作日志、订单/积分敏感操作双人确认。
- 隐私合规：弹窗告知收集目的、支持用户注销与数据导出。

## 10. 研发迭代计划（示例 10 周）
| 周期 | 里程碑 | 关键交付 |
| --- | --- | --- |
| W1 | 需求澄清 & 视觉确认 | 竞品调研、业务流程图、确认模板 UI 方向。 |
| W2 | 原型 & 技术方案 | Axure/墨刀原型、数据库 ER 图、API 草案。 |
| W3-W4 | Mini Program V1 | 登录、会员、公告、桌位展示、基础预约。 |
| W5-W6 | 点餐 & 支付 | 菜单管理、下单、支付、订单流、后厨联动。 |
| W7 | 积分 & 排行榜 | 规则引擎、积分明细、榜单、消息推送。 |
| W8 | 管理后台 | 菜单、桌位、订单、会员模块 + 权限。 |
| W9 | 联调 & 测试 | 功能/性能/安全测试，内容填充，演练。 |
| W10 | 上线 & 培训 | 小程序提审/发布，后台部署，运营培训。 |

## 11. 测试策略
- **功能测试**：模块级单测、接口自动化（Jest + Supertest）、小程序端 E2E（miniprogram-automator）。
- **性能测试**：预约高峰、点餐高峰压测（JMeter），关注数据库锁与消息延迟。
- **安全测试**：支付流程、权限绕过、输入校验、数据泄露扫描。
- **用户体验**：邀请酒吧核心玩家试用，收集桌位预约和点餐体验反馈。

## 12. 部署与运维
1. **环境**：Dev/Staging/Prod 分离；数据库主从 + 读写分离；Redis 高可用（哨兵/集群）。
2. **CI/CD**：代码提交 → 单元测试 → 构建镜像 → 安全扫描 → 自动部署到测试环境 → 人工灰度 → 生产发布。
3. **小程序发布**：`npm run build:mp` → 上传开发者工具 → 提审 → 审核通过后灰度发布 5%→50%→100%。
4. **后台发布**：打包静态资源至 COS + CDN；后端服务滚动发布（蓝绿/金丝雀）。
5. **监控与告警**：Prometheus + Grafana（服务指标）、SLS/ELK（日志）、APM（SkyWalking）、业务告警（预约失败、库存低、支付异常）。
6. **备份策略**：数据库每日全量、每小时增量，文件存储跨地域冗余，定期演练恢复。

## 13. 运营与增长建议
- 预约权益：会员优先选桌、订金抵消费。
- 活动推送：根据积分等级推送不同赛事或套餐。
- 线上线下联动：积分兑换实物/赛事门票，增加分享裂变（邀请好友得积分）。
- 数据洞察：通过 BI 看用户留存、桌位利用率、客单价、积分消耗，持续优化策略。

## 14. 交付物清单
1. 产品需求文档 + 原型 + 视觉稿（参考模板深化）。
2. 技术设计（架构、数据库、API 文档）。
3. 小程序源码 & 管理后台源码 & 后端服务。
4. 自动化测试脚本与结果。
5. 部署脚本/Helm Chart、监控告警配置。
6. 运营手册：预约规则、积分策略、活动配置指南。
