# 快速启动脚本

## 全流程启动命令

```bash
# 1. 确保MySQL和Redis正在运行
# 如果使用Docker:
docker start texas-mysql texas-redis

# 或者启动新容器:
docker run --name texas-mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=texas_poker -p 3306:3306 -d mysql:8
docker run --name texas-redis -p 6379:6379 -d redis:alpine

# 2. 运行数据库迁移（首次或数据模型变更后）
cd apps/server
pnpm migration:run

# 3. 初始化种子数据（首次或需要重置数据时）
pnpm seed

# 4. 启动后端服务
pnpm dev

# 5. 在另一个终端启动管理后台（可选）
cd apps/admin
pnpm dev

# 6. 使用微信开发者工具打开小程序
# 导入项目: apps/mp
```

## 验证安装

访问以下URL确认服务正常：

1. **后端API**: http://localhost:3000
2. **Swagger文档**: http://localhost:3000/docs
3. **管理后台**: http://localhost:5173 (如已启动)

## 测试API

```bash
# 测试菜单分类
curl http://localhost:3000/menu/categories

# 测试菜品列表
curl http://localhost:3000/menu/items

# 测试桌位列表
curl http://localhost:3000/tables

# 测试会员信息
curl http://localhost:3000/membership/members/current
```

## 小程序测试流程

1. 打开微信开发者工具
2. 导入项目 -> 选择 `apps/mp` 目录
3. 在详情 -> 本地设置 -> 勾选"不校验合法域名"
4. 编译运行
5. 测试功能：
   - 首页导航
   - 点餐页面（菜单加载）
   - 会员中心
   - 积分页面
   - 排行榜

## 常用调试命令

```bash
# 查看MySQL数据
mysql -uroot -p texas_poker -e "SELECT * FROM menu_categories"
mysql -uroot -p texas_poker -e "SELECT * FROM menu_items LIMIT 5"
mysql -uroot -p texas_poker -e "SELECT * FROM tables"

# 重置数据库
cd apps/server
pnpm migration:revert
pnpm migration:run
pnpm seed

# 查看后端日志
pnpm dev  # 控制台会显示所有日志

# 测试特定API
curl -X GET "http://localhost:3000/menu/items" -H "accept: application/json"
```

## 故障排除快速检查清单

- [ ] MySQL正在运行（端口3306）
- [ ] Redis正在运行（端口6379）
- [ ] 已创建 `.env` 文件
- [ ] 已安装依赖 (`pnpm install`)
- [ ] 已运行迁移 (`pnpm migration:run`)
- [ ] 已初始化数据 (`pnpm seed`)
- [ ] 后端服务正在运行 (`pnpm dev`)
- [ ] 小程序开发者工具已勾选"不校验合法域名"

## 端口占用检查

```bash
# Windows
netstat -ano | findstr :3000
netstat -ano | findstr :3306
netstat -ano | findstr :6379

# Linux/Mac
lsof -i :3000
lsof -i :3306
lsof -i :6379
```